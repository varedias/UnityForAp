StarFalling 动画系统 - 使用指南
============================================

## 📋 项目概述

这是一个完整的 Unity 动画系统，展示价签UI → 星星掉落 → 道路延伸的流畅动画效果。
适用于产品展示、广告动画、游戏特效等场景。

## 🚀 快速开始

### 方法一：使用自动设置工具（推荐）

1. 打开菜单：`Tools > Star Falling Animation > Scene Setup`
2. 点击"一键创建场景"按钮
3. 按下Unity播放按钮预览动画
4. 完成！

### 方法二：手动设置

1. 创建空物体 `MasterController` 并添加 `MasterController.cs` 组件
2. 创建 Canvas 和 UI 价签，添加 `PriceTagAnimator.cs`
3. 创建空物体 `StarSpawner` 并添加 `StarSpawner.cs`
4. 创建空物体 `RoadManager` 并添加 `RoadManager.cs`
5. 在 `MasterController` 中关联所有组件引用

## 📁 文件结构

```
Assets/
├── Scripts/               # 所有C#脚本
│   ├── MasterController.cs          # 主控制器
│   ├── PriceTagAnimator.cs          # 价签UI动画
│   ├── StarController.cs            # 星星动画
│   ├── StarSpawner.cs               # 星星生成器
│   ├── RoadManager.cs               # 道路管理
│   ├── CameraController.cs          # 摄像机控制
│   ├── EnvironmentSettings.cs       # 环境配置
│   ├── RecordingHelper.cs           # 录制辅助
│   ├── PerformanceOptimizer.cs      # 性能优化
│   ├── HelpBox.cs                   # 帮助信息
│   ├── AnimationAPIExample.cs       # API示例
│   └── Editor/                      # 编辑器工具
│       ├── SceneSetupTool.cs        # 场景设置工具
│       ├── PrefabCreator.cs         # Prefab创建工具
│       ├── MasterControllerEditor.cs # 自定义编辑器
│       └── QuickStartWindow.cs      # 快速启动窗口
├── Prefabs/               # 预制体（自动生成）
├── Materials/             # 材质
├── Animations/            # 动画文件
└── Models/                # 3D模型

```

## 🎯 核心组件说明

### 1. MasterController（主控制器）
- **功能**：控制整个动画流程
- **配置**：
  - `autoPlayOnStart`: 是否自动播放
  - `startDelay`: 开始延迟时间
- **快捷键**：Space 键重新播放

### 2. PriceTagAnimator（价签动画）
- **功能**：价签显示 → 停留 → 上移淡出
- **配置**：
  - `priceString`: 显示的价格文本
  - `displayDuration`: 停留时间（默认2秒）
  - `moveUpDistance`: 上移距离
  - `fadeOutDuration`: 淡出时间
- **API**：
  ```csharp
  priceTagAnimator.UpdatePrice("¥新价格");
  priceTagAnimator.PlayAnimation();
  ```

### 3. StarSpawner（星星生成器）
- **功能**：自动生成和管理星星
- **配置**：
  - `totalStarsToSpawn`: 总星星数量（0=无限）
  - `spawnInterval`: 生成间隔
  - `spawnCenter`: 生成中心位置
- **API**：
  ```csharp
  starSpawner.StartSpawning();
  starSpawner.StopSpawning();
  starSpawner.SpawnSingleStar();
  ```

### 4. StarController（星星控制）
- **功能**：单个星星的完整动画
- **流程**：掉落 → 落地弹跳 → 停留 → 淡出
- **配置**：
  - `fallDuration`: 掉落时间
  - `landDuration`: 停留时间
  - `fadeOutDuration`: 淡出时间

### 5. RoadManager（道路管理）
- **功能**：道路的生成和延伸
- **配置**：
  - `initialRoadSegments`: 初始道路段数
  - `segmentLength`: 每段长度
  - `roadWidth`: 道路宽度
  - `extendDuration`: 延伸动画时间
- **API**：
  ```csharp
  roadManager.ExtendRoad();
  roadManager.Reset();
  ```

### 6. CameraController（摄像机控制）
- **功能**：固定角度或跟随道路
- **模式**：
  - `FixedAngle`: 固定视角
  - `FollowRoad`: 跟随道路延伸
- **API**：
  ```csharp
  cameraController.SetFollowRoad(true);
  cameraController.SetCameraPosition(pos, rot);
  ```

## 🛠️ 编辑器工具

### Scene Setup Tool（场景设置工具）
- 菜单：`Tools > Star Falling Animation > Scene Setup`
- 功能：一键创建完整场景
- 支持：自定义价格、选择性创建组件

### Prefab Creator（预制体创建工具）
- 菜单：`Tools > Star Falling Animation > Prefab Creator`
- 功能：创建自定义星星和道路预制体
- 配置：颜色、大小、形状等

### Quick Start Guide（快速启动指南）
- 菜单：`Tools > Star Falling Animation > Quick Start Guide`
- 功能：首次使用时自动显示
- 内容：完整的设置步骤和功能介绍

## 🎨 自定义与扩展

### 更改价格
```csharp
PriceTagAnimator priceTag = FindObjectOfType<PriceTagAnimator>();
priceTag.UpdatePrice("¥限时特价 9.9");
```

### 调整动画速度
在各组件的Inspector中调整：
- 价签：`displayDuration`、`fadeOutDuration`
- 星星：`fallDuration`、`fadeOutDuration`
- 道路：`extendDuration`

### 切换环境
```csharp
EnvironmentSettings env = FindObjectOfType<EnvironmentSettings>();
env.SetDaytimeEnvironment();  // 白天
env.SetSunsetEnvironment();   // 黄昏
env.SetNightEnvironment();    // 夜晚
```

### 自定义动画序列
参考 `AnimationAPIExample.cs` 中的示例代码

## 📹 录制视频

### 安装 Unity Recorder
1. `Window > Package Manager`
2. 搜索 `Unity Recorder`
3. 点击安装

### 录制步骤
1. 添加 `RecordingHelper` 组件
2. 右键点击组件 → `Prepare For Recording`
3. `Window > General > Recorder > Recorder Window`
4. 配置录制设置（MP4, 60FPS）
5. 点击 START RECORDING
6. 播放场景
7. 完成后点击 STOP RECORDING

## ⚡ 性能优化

### 使用 PerformanceOptimizer 组件
```csharp
PerformanceOptimizer optimizer = gameObject.AddComponent<PerformanceOptimizer>();
optimizer.showFPS = true;  // 显示帧率
optimizer.SetQualityHigh(); // 设置高质量
```

### 优化建议
- 使用对象池减少实例化开销
- 启用静态批处理
- 调整阴影质量和抗锯齿级别
- 限制同时存在的星星数量

## 🐛 常见问题

### Q: 动画不播放？
A: 检查 MasterController 中的组件引用是否正确设置

### Q: 价签不显示？
A: 确保 Canvas 存在且 PriceTagAnimator 组件已正确配置

### Q: 星星不掉落？
A: 检查 StarSpawner 的 starPrefab 是否已设置（或使用程序化生成）

### Q: 道路不延伸？
A: 确认星星包含 StarController 组件且能正确触发事件

### Q: 材质显示异常？
A: 确保项目使用 URP 渲染管线，检查材质 Shader 是否正确

## 🔧 调试技巧

### 启用控制台日志
所有组件都包含详细的 Debug.Log 输出，可在 Console 窗口查看动画流程

### 使用 Gizmos
RoadManager 和 StarSpawner 包含 Gizmos 可视化，在 Scene 视图中可见

### Inspector 调试
运行时可在 Inspector 中实时调整参数查看效果

## 📦 导出与集成

### 导出为 Unitypackage
1. 选中 Assets 文件夹
2. `Assets > Export Package`
3. 确保包含所有脚本和预制体
4. 导出

### AR Foundation 集成
系统支持 AR Foundation，需要：
1. 安装 AR Foundation 包
2. 替换主摄像机为 AR Camera
3. 调整地面检测和放置逻辑

## 🎓 API 参考

详见 `AnimationAPIExample.cs` 中的12个示例：
1. 播放完整动画
2. 重置并重新播放
3. 更改价格
4. 自定义价签动画
5. 手动生成星星
6. 控制星星生成
7. 手动延伸道路
8. 延伸多段道路
9. 切换摄像机模式
10. 设置摄像机位置
11. 自定义动画序列
12. 数据驱动动画

## 📞 支持与反馈

如有问题或建议，请：
- 查看代码注释
- 使用 Context Menu 功能
- 参考 HelpBox 组件的帮助信息

## 📄 许可证

本项目为示例代码，可自由使用和修改。

---

**版本**: 1.0.0  
**创建日期**: 2025年10月28日  
**Unity 版本**: 2021.3+ (URP)
